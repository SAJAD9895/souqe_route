# Supabase Database Setup

To support the new registration form fields, you need to update your Supabase `leads` table.

## ‚ö†Ô∏è IMPORTANT: Fix the "name" Column Error

You're getting an error because the old `name` column still has a NOT NULL constraint. Here's how to fix it:

## Option 1: Update Existing Table (Recommended)

Run this SQL in your Supabase SQL Editor:

```sql
-- Step 1: Remove NOT NULL constraint from old 'name' column (if it exists)
ALTER TABLE leads ALTER COLUMN name DROP NOT NULL;

-- Step 2: Add new columns
ALTER TABLE leads
ADD COLUMN IF NOT EXISTS first_name TEXT,
ADD COLUMN IF NOT EXISTS last_name TEXT,
ADD COLUMN IF NOT EXISTS business_activity TEXT,
ADD COLUMN IF NOT EXISTS brands_represented TEXT,
ADD COLUMN IF NOT EXISTS mobile_number TEXT,
ADD COLUMN IF NOT EXISTS website TEXT,
ADD COLUMN IF NOT EXISTS office_no TEXT,
ADD COLUMN IF NOT EXISTS building_name TEXT,
ADD COLUMN IF NOT EXISTS street TEXT,
ADD COLUMN IF NOT EXISTS locality TEXT,
ADD COLUMN IF NOT EXISTS po_box TEXT,
ADD COLUMN IF NOT EXISTS city TEXT,
ADD COLUMN IF NOT EXISTS country TEXT;

-- Step 3: (Optional) Migrate existing data from 'name' to 'first_name'
-- UPDATE leads SET first_name = name WHERE first_name IS NULL AND name IS NOT NULL;

-- Step 4: (Optional) Drop the old 'name' column if you don't need it
-- ALTER TABLE leads DROP COLUMN name;

-- Step 5: (Optional) Drop old columns you don't need anymore
-- ALTER TABLE leads DROP COLUMN IF EXISTS role;
-- ALTER TABLE leads DROP COLUMN IF EXISTS category;
```

## Option 2: Create a Fresh Table

If you want to start fresh and don't need the old data:

```sql
-- Drop the old table
DROP TABLE IF EXISTS leads;

-- Create new table with all fields
CREATE TABLE leads (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    company TEXT NOT NULL,
    business_activity TEXT NOT NULL,
    brands_represented TEXT,
    phone TEXT NOT NULL,
    mobile_number TEXT,
    email TEXT NOT NULL,
    website TEXT,
    office_no TEXT,
    building_name TEXT,
    street TEXT,
    locality TEXT,
    po_box TEXT,
    city TEXT NOT NULL,
    country TEXT NOT NULL,
    message TEXT,
    status TEXT DEFAULT 'new'
);

-- Enable Row Level Security (RLS)
ALTER TABLE leads ENABLE ROW LEVEL SECURITY;

-- Create policy to allow inserts from anyone (for the registration form)
CREATE POLICY "Allow public insert" ON leads
FOR INSERT TO anon
WITH CHECK (true);

-- Create policy to allow authenticated users to read all leads (for admin)
CREATE POLICY "Allow authenticated read" ON leads
FOR SELECT TO authenticated
USING (true);

-- Create policy to allow authenticated users to update leads (for admin)
CREATE POLICY "Allow authenticated update" ON leads
FOR UPDATE TO authenticated
USING (true);
```

## üîß Quick Fix (Run This Now!)

**Copy and paste this into your Supabase SQL Editor:**

```sql
ALTER TABLE leads ALTER COLUMN name DROP NOT NULL;

ALTER TABLE leads
ADD COLUMN IF NOT EXISTS first_name TEXT,
ADD COLUMN IF NOT EXISTS last_name TEXT,
ADD COLUMN IF NOT EXISTS business_activity TEXT,
ADD COLUMN IF NOT EXISTS brands_represented TEXT,
ADD COLUMN IF NOT EXISTS mobile_number TEXT,
ADD COLUMN IF NOT EXISTS website TEXT,
ADD COLUMN IF NOT EXISTS office_no TEXT,
ADD COLUMN IF NOT EXISTS building_name TEXT,
ADD COLUMN IF NOT EXISTS street TEXT,
ADD COLUMN IF NOT EXISTS locality TEXT,
ADD COLUMN IF NOT EXISTS po_box TEXT,
ADD COLUMN IF NOT EXISTS city TEXT,
ADD COLUMN IF NOT EXISTS country TEXT;
```

After running this, your registration form should work! ‚úÖ

